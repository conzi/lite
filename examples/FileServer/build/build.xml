<?xml version="1.0" encoding="GBK"?>
<project name="fileserver" default="build" basedir="../">
	<tstamp>
		<format property="version" pattern="yyyyMMdd" />
	</tstamp>
	<target name="compile">
		<delete dir="build/dest/classes"/>
		<mkdir dir="build/dest/classes"/>
		<copy todir="build/dest/classes">
			<fileset dir="src/main">
				<include name="**/*"/>
			</fileset>
		</copy>
		<javac target="1.5" srcdir="build/dest/classes" destdir="build/dest/classes">
			<classpath>
				<fileset dir="web/WEB-INF/lib">
					<include name="*.jar"/>
				</fileset>
			</classpath>
		</javac>
	</target>
	<target name="build">
		<delete dir="${basedir}/build/dest/" />
		<mkdir dir="${basedir}/build/dest/" />
		<antcall target="compileLite" />
		<jar destfile="${basedir}/build/dest/fs.jar">
			<manifest>
				<attribute name="Main-Class" value="org.jside.filemanager.FileManager" />
			</manifest>
			<fileset dir="${basedir}/web/WEB-INF/classes">
				<include name="**/*.class" />
				<include name="**/mime.types" />
				<exclude name="**/test/**/*.*" />
			</fileset>
			<zipfileset prefix="org/jside/filemanager/" dir="${basedir}/build/dest/lite">
				<include name="^*.xhtml" />
			</zipfileset>
			<zipfileset src="${basedir}/web/WEB-INF/lib/Template.jar">
				<include name="**/*.class" />
				<exclude name="org/xidea/lite/parser/**/*.*" />
				<exclude name="org/xidea/lite/servlet/**/*.*" />
				<exclude name="org/xidea/lite/tools/**/*.*" />
			</zipfileset>
			<zipfileset src="${basedir}/web/WEB-INF/lib/Template.jar">
				<include name="org/xidea/lite/parser/ResourceContext.class" />
				<include name="org/xidea/lite/parser/impl/ResourceContextImpl.class" />
			</zipfileset>
		</jar>
	</target>
	<target name="compileLite">
		<delete dir="${basedir}/build/dest/lite" />
		<mkdir dir="${basedir}/build/dest/lite" />
		<java fork="true" classname="org.xidea.lite.tools.LiteCompiler" classpath="web/WEB-INF/lib/Template.jar">
			<arg value="-root" />
			<arg value="${basedir}/src/main/org/jside/filemanager/" />
			<arg value="-litecached" />
			<arg value="${basedir}/build/dest/lite" />
		</java>
	</target>
</project>