<?xml version="1.0" encoding="utf-8" ?>
<java version="1.6.0_02" class="java.beans.XMLDecoder">
	<string><![CDATA[
//{{if test}}....{{/endif}}
var $if = {
	parse : function(context,text,start){
		var end = text.indexOf("}}",start);
		var el = text.substring(start+5,end);
		el = context.parseEL(el);
		context.appendIf(el);
		return end+2;
	},
	findStart : function(context,text,start){
		return text.indexOf("{{if",start);
	}
};
//{{for item:items}}....{{/endfor}}
var $for = {
	parse : function(context,text,start){
		var end = text.indexOf("}}",start);
		var el = text.substring(start+6,end);
		el = el.replace(/^\s+/,'');
		var split = el.indexOf(':')
		var varName = el.substring(0,split).replace(/\s+$/,'');
		var items = el.substring(split+1);
		el = context.parseEL(items);
		context.appendFor(varName,el,null);
		return end+2;
	},
	findStart : function(context,text,start){
		return text.indexOf("{{for",start);
	}
};
//{{if test}}....{{else test2}}{{/endelse}}
var $else = {
	parse : function(context,text,start){
		var end = text.indexOf("}}",start);
		var el = text.substring(start+6,end);
		if(/^\s*$/.test(el)){
			context.appendEnd();
			context.appendElse(null);
		}else{
			el = context.parseEL(el);
			context.appendEnd();//不要放前面，因为你的parserEL有可能会抛出异常
			context.appendElse(el);
		}
		return end+2;
	},
	findStart : function(context,text,start){
		return text.indexOf("{{else",start);
	}
};
var $var = {
	parse : function(context,text,start){
		var end = text.indexOf("}}",start);
		var el = text.substring(start+5,end);
		el = el.replace(/^\s+|\s+$/,'');
		var split = el.indexOf('=')
		if(split>0){
			var value = el.substring(split+1);
			var varName = el.substring(0,split).replace(/\s+$/,'');
			var el = context.parseEL(value);
			context.appendVar(varName,el);
		}else{
			var varName = el;
			context.appendCaptrue(varName);
		}
		return end+2;
	},
	findStart : function(context,text,start){
		return text.indexOf("{{var",start);
	}
};
var $end = {
	parse : function(context,text,start){
		context.appendEnd();
		return text.indexOf("}}",start)+2;
	},
	findStart : function(context,text,start){
		var begin = text.indexOf("{{/",start);
		if(begin>0){
		    var end = text.indexOf("}}",begin);
		    switch(text.substring(begin+3,end)){
		    	case 'endif':
		    	case 'endfor':
		    	case 'endelse':
		    	case 'endvar':
		    	case 'end':
		    	return begin;
		    }
		}
		return -1;
	}
}
$client = {

}
var $el = {
	parse : function(context,text,start){
		var end = text.indexOf("}}",start);
		var el = context.parseEL(text.substring(start+2,end));
		context.appendEL(el);
		return end+2;
	},
	findStart : function(context,text,start){
		return text.indexOf("{{",start);
	}
}
context.addInstructionParser($if);
context.addInstructionParser($for);
context.addInstructionParser($else);
context.addInstructionParser($var);
context.addInstructionParser($end);
//示例嘛，还是有待完善的，这个必须放在后面：（
context.addInstructionParser($el);
	]]></string>
	<object class="java.util.LinkedHashMap">
		<void method="put">
			<string>xml</string>
			<string><![CDATA[<"'>]]></string>
		</void>
		<void method="put">
			<string>test</string>
			<boolean>true</boolean>
		</void>
	</object>
	<object class="java.util.LinkedHashMap">
		<!-- testXMLText -->
		<void method="put">
			<string>
				<![CDATA[
{{if 1>0}}1>0{{/endif}}
{{var items = [1,2,3]}}
{{for item:items}}{{if for.index>0}},{{/endif}}{{item}}{{else}}
没有记录
{{/endfor}}
]]></string>
			<string>
				<![CDATA[
1>0

1,2,3
]]></string>
		</void>
	</object>
</java>